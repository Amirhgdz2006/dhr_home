import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import sharp from 'sharp';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Talent Club SVG path
const talentClubPath = "M28.8386 9.07231C28.7874 8.97594 28.7146 8.89266 28.626 8.82895C28.5428 8.76631 28.4476 8.72155 28.3463 8.69747C28.2393 8.67507 28.1288 8.67507 28.0218 8.69747C27.9192 8.72526 27.8237 8.77488 27.7421 8.84293L25.5685 10.5493C25.366 10.6612 25.1384 10.7199 24.907 10.7199C24.6756 10.7199 24.4479 10.6612 24.2454 10.5493L17.3388 6.71977C17.252 6.67117 17.1798 6.60033 17.1295 6.51453C17.0792 6.42873 17.0527 6.33108 17.0527 6.23163C17.0527 6.13218 17.0792 6.03453 17.1295 5.94873C17.1798 5.86294 17.252 5.79209 17.3388 5.7435L19.7865 4.29728C19.8588 4.25486 19.9186 4.19406 19.9599 4.12105C20.0003 4.04883 20.0216 3.96745 20.0216 3.88468C20.0216 3.80191 20.0003 3.72053 19.9599 3.64831C19.9186 3.5753 19.8588 3.5145 19.7865 3.47207L18.4773 2.7168C17.7544 2.29942 16.9344 2.07969 16.0996 2.07969C15.2648 2.07969 14.4448 2.29942 13.7219 2.7168L5.49774 7.45266C4.77492 7.86998 4.17467 8.4702 3.7573 9.19299C3.33993 9.91578 3.12014 10.7357 3.12002 11.5703V21.0477C3.12014 21.8823 3.33993 22.7022 3.7573 23.425C4.17467 24.1478 4.77492 24.748 5.49774 25.1653L13.7023 29.9012C14.4252 30.3186 15.2453 30.5383 16.08 30.5383C16.9148 30.5383 17.7348 30.3186 18.4577 29.9012L26.6623 25.1653C27.3855 24.7478 27.986 24.1471 28.4034 23.4238C28.8208 22.7005 29.0404 21.88 29.04 21.0449V9.91151C29.0408 9.61972 28.9717 9.33198 28.8386 9.07231ZM20.2145 23.3387L17.1654 25.045C16.9634 25.1587 16.7356 25.2185 16.5038 25.2185C16.272 25.2185 16.0442 25.1587 15.8422 25.045L8.94684 21.2295C8.86007 21.1809 8.78782 21.11 8.73754 21.0242C8.68725 20.9384 8.66074 20.8408 8.66074 20.7413C8.66074 20.6419 8.68725 20.5442 8.73754 20.4584C8.78782 20.3726 8.86007 20.3018 8.94684 20.2532L11.954 18.4769C12.0325 18.4312 12.1218 18.4071 12.2127 18.4071C12.3036 18.4071 12.3929 18.4312 12.4715 18.4769L20.2173 22.9163C20.2534 22.9385 20.2825 22.9705 20.3012 23.0086C20.3224 23.045 20.3331 23.0867 20.3319 23.1289C20.3317 23.1709 20.3211 23.2122 20.3012 23.2491C20.2806 23.2861 20.2507 23.317 20.2145 23.3387ZM24.4636 16.0964L21.4145 17.8C21.2131 17.9137 20.9857 17.9735 20.7543 17.9735C20.523 17.9735 20.2956 17.9137 20.0942 17.8L13.1904 13.976C13.1002 13.9292 13.0254 13.8573 12.975 13.769C12.9232 13.6823 12.8959 13.5833 12.8959 13.4823C12.8959 13.3813 12.9232 13.2823 12.975 13.1956C13.0254 13.1073 13.1002 13.0354 13.1904 12.9886L16.1975 11.2151C16.2761 11.1694 16.3654 11.1453 16.4563 11.1453C16.5472 11.1453 16.6364 11.1694 16.715 11.2151L24.4664 15.66C24.505 15.6818 24.5369 15.7137 24.5587 15.7523C24.5809 15.7906 24.5925 15.834 24.5923 15.8782C24.5903 15.9224 24.5778 15.9656 24.5559 16.0041C24.5341 16.0427 24.5022 16.0746 24.4636 16.0964Z";

// Background color for Talent Club (purple)
const bgColor = "#875bf7";

// Create SVG content
function createSVG(size) {
  return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg">
  <rect width="${size}" height="${size}" fill="${bgColor}"/>
  <g transform="scale(${size / 32})">
    <path d="${talentClubPath}" fill="white"/>
  </g>
</svg>`;
}

// Create public directory if it doesn't exist
const publicDir = path.join(__dirname, '..', 'public');
if (!fs.existsSync(publicDir)) {
  fs.mkdirSync(publicDir, { recursive: true });
}

// Generate PNG icons from SVG
async function generateIcons() {
  console.log('Generating PNG icons from Talent Club SVG...');
  
  const svg192 = createSVG(192);
  const svg512 = createSVG(512);
  
  // Generate 192x192 PNG with explicit options
  await sharp(Buffer.from(svg192))
    .png({ 
      compressionLevel: 9,
      quality: 100,
      force: true
    })
    .resize(192, 192, {
      fit: 'contain',
      background: { r: 135, g: 91, b: 247, alpha: 1 } // #875bf7
    })
    .toFile(path.join(publicDir, 'icon-192.png'));
  
  console.log('✓ Created icon-192.png');
  
  // Generate 512x512 PNG with explicit options
  await sharp(Buffer.from(svg512))
    .png({ 
      compressionLevel: 9,
      quality: 100,
      force: true
    })
    .resize(512, 512, {
      fit: 'contain',
      background: { r: 135, g: 91, b: 247, alpha: 1 } // #875bf7
    })
    .toFile(path.join(publicDir, 'icon-512.png'));
  
  console.log('✓ Created icon-512.png');
  console.log('Icons generated successfully!');
}

generateIcons().catch(console.error);
